---
title: "Statistics - Wine"
author: "IA - 04"
date: "1 de janeiro de 2019"
output:
  html_document:
    fig_height: 6
    fig_width: 10
    number_sections: yes
    toc: yes
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Parte I

## Bibliotecas
```{r echo=TRUE, warning=FALSE, message=FALSE}
library(data.table)
library(dplyr)
library(ggplot2)
library(grid)
library(plotly)
library(tibble)
library(stringr)
```

## Importando os dados
```{r echo=TRUE, warning=FALSE, message=FALSE}
wine_dset <- read.csv2('BaseWine_Red_e_White2018.csv')
```

### Identificando as variáveis

Para começar nossa análise vamos identificar as variáveis para entender o que elas podem significar no contexto da composição de um vinho. 

```{r var_vinhos}
str(wine_dset)
```
<BR>
"fixedacidity" -> *Acidex Fixa* : Acidez é uma das características básica que tem uma contribuição  relevante para o sabor, frescura, equilíbrio e capacidade de conservação dos vinhos. Acidez Fixa é a diferença entre acidez total do vinho e sua acidez volátil. <BR><BR>

"volatileacidity" -> *Acidex Volátil* : É um componente do vinho que tipicamente cresce conforme o vinho envelhece e, em quando atinge um nível elevado, é responsável pelo aroma de vinagre. É o resultado da falta de cuidados durante a vinificação. <BR><BR>

"citricacid" -> *Ácido Cítrico* : Nos vinhos o ácido cítrico tem pouca ou nenhuma presença. Nos vinhos tintos desaparece devido à ação de bactérias láticas (fermentação malolática). Sensorialmente é fresco, porém em alguns casos pode apresentar um leve final amargo. <BR><BR>

"residualsugar" -> *Açucar Residual* : No processo de fermentação do vinho a levedura vai transformando o açúcar da uva em álcool. Por isso que, em teoria, quanto mais açúcar houver na uva, mais álcool haverá no vinho. Porem nem todo o açucar é transformado em alcool, e o açucar que resta no final do processo de fermentação é conhecido como açucar residual. <BR><BR>

"chlorides" -> *Cloretos* : Os vinhos possuem em sua composição diversos produtos enológicos, sais e ácidos. Estes sais influenciam diretamente em sua qualidade. <BR><BR>

"freesulfurdioxide" -> *Dioxido de Enxofre Livre* : As atividade antioxidásica do Dioxido de Enxofre bloqueia a ação de enzimas oxidantes, principalmente no início do processo de elaboração, evitando reações de oxidação e o conseqüente escurecimento do vinho. <BR><BR>

"totalsulfurdioxide" -> *Dioxido de Enxofre Total* : Dioxido de Enxofre é usado como conservante nos vinhos . <BR><BR>

"density" -> *Densidade* : Define a leveza do vinhos, e pode ser caracterizado pelo tipo da uva ou por técnicas usadas na vinificação que podem ser determinantes na concentração da bebida. <BR><BR>

"pH" -> *PH* : Vinhos são naturalmente ácidos, com a maioria indo de 2,8 a 4,0. Os níveis de pH estão intrinsecamente ligados ao estilo e qualidade dos vinhos. O pH relativamente baixo, na faixa de 3,1 a 3,4, parece ser pré-requisito para a produção de vinhos de alta qualidade com solidez. <BR><BR>

"sulphates" -> *Sulfatos* : Os sulfitos também tem um papel de conservantes nos vinhos e ajudam na extração dos compostos fenólicos do vinho, responsáveis pela concentração de cor e taninos. <BR><BR>

"alcohol" -> *Alchool* : O teor ácido é aquele responsável por conferir a textura e sensação de frescor. O teor ácido do vinho está diretamente ligado ao tipo de uva com o qual foi produzido, e o ideal é encontrar o equilíbrio perfeito entre o açúcar e a acidez ideal na hora da colheita. <BR><BR>

"quality" -> *Qualidade* : Uma infidade de aspectos influenciam na qualidade dos vinhos, desde aspectos como o nivel de oxidação, até a contaminação da rolha. <BR><BR>

"Vinho" -> *Vinho* : Os principais tipos de vinhos são Tintos e Brancos, mas há também outros tipos como vinhos roses, doces e espumantes. <BR><BR>
  
### Uma visão rápida no dataset
```{r echo=TRUE, warning=FALSE, message=FALSE}
glimpse(wine_dset)
```
  
### Tamanho do dataset dividido pelo tipo de vinho
```{r echo=TRUE, warning=FALSE, message=FALSE}
wine_dset %>% 
  group_by(Vinho) %>% 
  count()
```
  
### Integridade dos dados por tipo de vinho
```{r echo=TRUE, warning=FALSE, message=FALSE}
wine_white_dset <- 
  wine_dset %>%
  filter(Vinho == 'WHITE')

wine_red_dset <- 
  wine_dset %>% 
  filter(Vinho == 'RED')

sum(is.na(wine_white_dset))
sum(is.na(wine_red_dset))
                      
```
  
  
### Característica de cada tipo de vinho  
O vinho branco e vermelho apresentam características diferentes que definem se ele é bom ou ruim. Vamos dar uma olhada nos dados pra cada característica:  
  
#### Sumário dos dados  
  
  
__Vinho Branco__  
```{r echo=TRUE, warning=FALSE, message=FALSE}
summary(wine_white_dset)
```
  
  
__Vinho Vermelho__  
```{r echo=TRUE, warning=FALSE, message=FALSE}
summary(wine_red_dset)
```
  
##### Diferença da mediana das características  
  
  
__Medianas - Tinto dataset__

```{r echo=TRUE, warning=FALSE, message=FALSE}
## fixedacidity

median_red_dset <-  sapply(select(wine_red_dset, -c(Vinho, id_vinho, quality)), median)


median_red_dset <- as.data.frame(median_red_dset)
`colnames<-`(median_red_dset, "Median")

```
  
  
__Medianas - Branco dataset__
```{r echo=TRUE, warning=FALSE, message=FALSE}


median_white_dset <-  sapply(select(wine_white_dset, -c(Vinho, id_vinho, quality)),median)

median_white_dset <- as.data.frame(median_white_dset)
`colnames<-`(median_white_dset, "Median")

```
  
  
__Diferença das medianas entre os dois tipos de vinhos__
```{r echo=TRUE, warning=FALSE, message=FALSE}

Cmedian_differenc <- abs(median_white_dset - median_red_dset)
Cmedian_differenc <- `colnames<-`(Cmedian_differenc, "Mediana_Difer")
Cmedian_differenc <- rownames_to_column(Cmedian_differenc)
Cmedian_differenc %>%
  arrange(desc(Mediana_Difer)) %>%
  rename(Caracteristica = rowname)
```

Nota: a ordem descendente dessas características será utilizada nos plots para uma melhor visualização: 

##### Histogramas de cada característica  
```{r echo=TRUE, warning=FALSE, message=FALSE}
plot_ly(wine_dset, y = ~totalsulfurdioxide,type = "box",
              color = ~Vinho, colors = c("red", "khaki")) %>% 
      layout(title = "Dióxido de Enxofre Total")

```
  
```{r echo=TRUE, warning=FALSE, message=FALSE}

plot_ly(wine_dset, y = ~freesulfurdioxide,type = "box",
              color = ~Vinho, colors = c("red", "khaki")) %>% 
      layout(title = "Dióxido de Enxofre Livre")

```
  
```{r echo=TRUE, warning=FALSE, message=FALSE}

plot_ly(wine_dset, y = ~residualsugar,type = "box",
              color = ~Vinho, colors = c("red", "khaki")) %>% 
      layout(title = "Açúcar Residual")

```
  
```{r echo=TRUE, warning=FALSE, message=FALSE}

plot_ly(wine_dset, y = ~fixedacidity,type = "box",
              color = ~Vinho, colors = c("red", "khaki")) %>% 
      layout(title = "Acidez Fixa")

```

Notando a media de cada característica, vemos uma diferença considerável pra cada vinho (Branco ou Vermelho), portanto, vamos pegar somente um tipo de vinho para uma análise coerente.  
  
Como o número de dados pros vinhos brancos é bem maior do que o para os vermelhos (aprox. 3 vezes maior), seria interessante utilizar os dados que oferecem mais amostras pra treinar e validar nosso modelo.  

# Parte II - (Vinhos Brancos)

A partir da análise acima, decidimos continuar somente com os vinhos branco por causa da quantidade e outros aspectos relevantes das váriaveis envolvidas.

## Regresão Linear

Indentificando os componentes principais do dataset

```{r echo=TRUE, warning=FALSE, message=FALSE}

#install.packages("dplyr")
library(dplyr)

wine_dset$Vinho <- as.numeric(wine_dset$Vinho)

fix(wine_dset)

Padr_Vinhos <- scale(wine_dset)
acpcor <- prcomp(Padr_Vinhos, scale = TRUE)

Vinhos2 <- wine_dset %>%
  mutate(pc1 = acpcor$x[, 1]) %>%
  mutate(pc2 = acpcor$x[, 2]) %>%
  mutate(pc3 = acpcor$x[, 3]) %>%
  mutate(pc4 = acpcor$x[, 4]) 

matcor <- cor(Vinhos2)

#install.packages("corrplot")
library(corrplot)

corrplot::corrplot(matcor, method="circle", order="hclust")

```

Com base no gráfico gerado de componentes principais;

Mediante nossa análise as Váriaveis dependentes são: 

chlorides, volatileacidity, sulphates, freesulfurdioxide, totalsulfurdioxide, fixedacidity

```{r echo=TRUE, warning=FALSE, message=FALSE}

a <- 1

```

Váriaveis independentes

```{r echo=TRUE, warning=FALSE, message=FALSE}

b <- 2

```

  
